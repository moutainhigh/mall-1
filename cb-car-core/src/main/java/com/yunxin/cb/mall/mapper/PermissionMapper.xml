<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yunxin.cb.mall.dao.PermissionDao">

<resultMap type="Permission" id="Permission">
	<id column="permission_id" property="permissionId" javaType="java.lang.Integer" jdbcType="INTEGER"/>
	<result column="role_id" property="roleId" javaType="java.lang.Integer" jdbcType="INTEGER"/>
	<result column="privilege_code" property="privilegeCode" javaType="java.lang.String" jdbcType="VARCHAR"/>
</resultMap>


<!-- 全部字段，一般用于明细查询 -->
<sql id="AllColumnlist">
permission_id,role_id,privilege_code
</sql>

<!-- 常见字段，一般用于列表查询，可能不包含备注之类的字段 -->
<sql id="CommonColumnlist">
permission_id,role_id,privilege_code
</sql>

<insert id="add" parameterType="Permission" useGeneratedKeys="true" keyProperty="permissionId">
	insert into PERMISSION(
		<if test="permissionId!=null">
		permission_id,
		</if>
		role_id,
		privilege_code
	) values (
		<if test="permissionId!=null">
		#{permissionId,jdbcType = INTEGER},
		</if>
		#{roleId,jdbcType = INTEGER},
		#{privilegeCode,jdbcType = VARCHAR}
	)
</insert>

<update id="update" parameterType="Permission">
	update PERMISSION 
	<set>
		<if test="roleId!=null ">
			role_id=#{roleId,jdbcType = INTEGER},
		</if>
		<if test="privilegeCode!=null and privilegeCode!=''">
			privilege_code=#{privilegeCode,jdbcType = VARCHAR},
		</if>
	</set>
	<where>
		AND permission_id=#{permissionId}
	</where>
</update>

<delete id="delete">
	delete from PERMISSION 
	<where>
		permission_id=#{0}
	</where>
</delete>

<select id="get" resultMap="Permission">
	select <include refid="AllColumnlist"/> from PERMISSION
	<where>
		permission_id=#{0}
	</where>
</select>

<select id="getByIds" resultMap="Permission">
	select <include refid="AllColumnlist"/> from PERMISSION
	<where>
		permission_id in <foreach item="item" index="index" collection="array" open="(" separator="," close=")">#{item}</foreach>
	</where>
</select>

<select id="count" parameterType="Query" resultType="Long">
	select count(permission_id) from PERMISSION 
	<where>
	<include refid="listCommonWhere"/>
	</where>
</select>

<select id="queryAll" parameterType="Query" resultMap="Permission">
	select <include refid="CommonColumnlist"/> from PERMISSION 
	<where>
	<include refid="listCommonWhere"/>
	</where>
</select>

<select id="pageList" parameterType="Query" resultMap="Permission">
	select <include refid="CommonColumnlist"/> from PERMISSION
	<where>
	 <include refid="listCommonWhere"/>
	</where>
	<![CDATA[LIMIT #{rowIndex},#{pageSize} ]]>
</select>


<sql id="listCommonWhere">
	<if test="data!=null">
		<if test="data.permissionId!=null ">
			AND permission_id=#{data.permissionId}
		</if>
		<if test="data.roleId!=null ">
			AND role_id=#{data.roleId}
		</if>
		<if test="data.privilegeCode!=null and data.privilegeCode!=''">
			AND privilege_code=#{data.privilegeCode}
		</if>
	</if>
</sql>

</mapper>